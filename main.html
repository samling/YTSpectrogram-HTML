<!DOCTYPE html>
<html>
	<head>
        <meta charset="utf-8" />
		<title>Main</title>
        <script
          src="https://code.jquery.com/jquery-3.2.1.min.js"
          integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
          crossorigin="anonymous"></script>
	</head>
	<body>
        <iframe id="ytplayer" type="text/html" width="640" height="360" frameborder="0" style="display:block"></iframe>
        <canvas id="spectrogram" height="100" style"display:block"></canvas>
	</body>
</html>

<script type="text/javascript">
    var sampleVals = []
    var urlParams = new URLSearchParams(window.location.search);
    var youtubeUrl = urlParams.get("yt");
    var id = youtubeUrl.split("=");
    $.ajax({
        url: "https://sboynton.com/api/Samples/" + id[1],
        type: "GET",
        async: false,
        success: function(response){
            jsonData = JSON.parse(response);
            for (var i = 0; i < jsonData.SampleData.length; i++) {
                val = jsonData.SampleData[i].Value
                sampleVals.push(val)
            }
        }
    });
    var canvas = $("#spectrogram")[0];
    var video = $("#ytplayer");
    canvas.width = video.width();
    document.getElementById("ytplayer").src = youtubeUrl.replace("watch?v=", "v/");

    if (canvas.getContext) {
        var ctx = canvas.getContext('2d');
        for (var i = 0; i < sampleVals.length; i++) {
            ctx.fillRect(i*(canvas.width/sampleVals.length), 0, 0.1, sampleVals[i]*100);
        }
    }
</script>	
